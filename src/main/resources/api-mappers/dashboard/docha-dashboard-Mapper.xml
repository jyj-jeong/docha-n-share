<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ohdocha.admin.mapper.DochaAdminDashboardMapper">

	<select id="selectDochaDashboardList" parameterType="DochaMap" resultType="DochaMap">

		<!-- 시스템관리자 AD -->
		<if test =" userRole != null and userRole != '' and userRole.equals('RA') ">
			SELECT IFNULL(COUNT(UR_IDX) , '0') AS CNT                              /* 매출 SUM */
			FROM   DC_USER_INFO
			WHERE  USER_ROLE IN('RU')

			UNION ALL
			SELECT IFNULL(COUNT(RT_IDX) , '0')
			FROM   DC_RENT_COMPANY                                          /* 예약 SUM */

			UNION ALL
			SELECT IFNULL(COUNT(QU_IDX) , '0')
			FROM   DC_QUOTE_USER
			WHERE DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')         /* 누적월차 SUM */

			UNION ALL
			SELECT COUNT(RM_IDX)
			FROM   DC_RESERVE_MASTER
			WHERE DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')        /* 취소 건수 SUM */

			UNION ALL
			SELECT IFNULL(COUNT(QU_IDX)  , '0') as QnA
			FROM   DC_QUESTION                                                          /* QnA SUM */

		</if>



		<!-- 회원사 CA -->
		<if test =" userRole != null and userRole != '' and userRole.equals('CA') and rtIdx != null and rtIdx != '' ">

			SELECT COUNT(RM_IDX) AS CNT
			FROM   DC_RESERVE_MASTER
			WHERE  RT_IDX = #{rtIdx}                                    /* 회원사 총 계약건수 */

			UNION ALL
			SELECT COUNT(QR_IDX)
			FROM   DC_QUOTE_RENT_COMPANY
			WHERE  RT_IDX = #{rtIdx}                                    /* 회원사가보낸 총 견적건수 */

			UNION ALL
			SELECT COUNT(QR_IDX)
			FROM   DC_QUOTE_RENT_COMPANY
			WHERE  RT_IDX = #{rtIdx}
			AND    DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')    /* 회원사가 금일 보낸 총 견적건수 */

			UNION ALL
			SELECT COUNT(CR_IDX)
			FROM   DC_CAR_INFO
			WHERE  RT_IDX = #{rtIdx}                                    /* 회원사가 등록할 총 차량 수*/

			UNION ALL
			SELECT COUNT(RM_IDX) AS CNT
			FROM   DC_RESERVE_MASTER
			WHERE  RT_IDX = #{rtIdx}
			AND    DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')      /* 회원사 금일 계약건수 */
		</if>


	</select>

	<select id="selectQnACnt" parameterType="DochaMap" resultType="DochaMap">

			SELECT IFNULL(COUNT(UR_IDX) , '0') AS CNT                              /* 매출 SUM */
			FROM   DC_USER_INFO
			WHERE  USER_ROLE IN('RU')

			UNION ALL
			SELECT IFNULL(COUNT(RT_IDX) , '0')
			FROM   DC_RENT_COMPANY                                          /* 예약 SUM */

			UNION ALL
			SELECT IFNULL(COUNT(QU_IDX) , '0')
			FROM   DC_QUOTE_USER
			WHERE DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')         /* 누적월차 SUM */

			UNION ALL
			SELECT COUNT(RM_IDX)
			FROM   DC_RESERVE_MASTER
			WHERE DATE_FORMAT(REG_DT , '%Y%m%d') = DATE_FORMAT(NOW() , '%Y%m%d')        /* 취소 건수 SUM */

			UNION ALL
			SELECT IFNULL(COUNT(QU_IDX)  , '0') as QnA
			FROM   DC_QUESTION                                                          /* QnA SUM */

</mapper>





