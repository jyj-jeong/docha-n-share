<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.ohdocha.admin.mapper.CsdealAdminMenuMapper">


    <select id="selectMenuInfoList" parameterType="menuRequest"	resultType="menuResponse">
	    <![CDATA[
	    	SELECT
			 			DISTINCT	
						T1.MENU_CD  AS MENU_CD   													/* 메뉴코드 */ 
					,	T1.MENU_NM  AS MENU_NM   													/* 메뉴명  */ 
					,	T1.MENU_URL AS MENU_URL  													/* 메뉴경로 */
					,	T1.UPPER_MENU_CD AS UPPER_MENU_CD											/* 부모번호 */ 
					,	LTRIM (SYS_CONNECT_BY_PATH (T1.MENU_NM, ' > '), ' > ') AS DEPTH_FULLNAME	/*전체 메뉴 경로*/ 
					,	IFNULL(T1.USE_YN, 'N') AS USE_YN  												/* 메뉴코드 사용여부 */
					,	T2.NEW_YN			AS NEW_YN												/* 등록권한여부 1 사용 0 미사용*/	  
					,	T2.READ_YN			AS READ_YN												/* 읽기권한여부 1 사용 0 미사용*/
					,	T2.DEL_YN 			AS DEL_YN												/* 삭제권한여부 1 사용 0 미사용*/
					,	T2.EXCELDOWN_YN	AS EXCELDOWN_YN												/* 엑셀다운권한여부 1 사용 0 미사용*/
					,	T1.MENU_ORDER		AS MENU_ORDER											/* ORDER BY 순서*/
					,	T1.MENU_DC			AS MENU_DC												/* 메뉴 설명*/
					,	T1.MENU_LEVEL  AS MENU_LEVEL												/* 메뉴 LEVEL*/
			FROM CDT_MENU T1
			LEFT JOIN CDT_MENU_TEMPLATE_LIST T2
       			   ON T1.MENU_CD = T2.MENU_CD
			LEFT JOIN CDT_MENU_TEMPLATE T3
       			   ON T2.TEMPLATE_CD = T3.TEMPLATE_CD
	    ]]>
	    <trim prefix="WHERE" prefixOverrides="AND|OR">
					   T1.USE_YN='Y'
				   AND T2.READ_YN='Y'
			<if test="userRole != null and userRole != ''">
				   AND T3.USER_ROLE=#{userRole}
			</if>
			START WITH T1.MENU_LEVEL=1
			CONNECT BY PRIOR
			T1.MENU_CD = DECODE(T2.MENU_CD, T1.UPPER_MENU_CD, NULL, T1.UPPER_MENU_CD)
			ORDER BY T1.MENU_CD ASC     
	    </trim> 
		<!-- <![CDATA[
				SELECT 
						  IFNULL(A.MENU_CD, '')  AS MENU_CD   											/* 메뉴코드 */
						, IFNULL(A.MENU_NM, '')  AS MENU_NM   											/* 메뉴명  */
						, IFNULL(A.MENU_URL, '') AS MENU_URL  											/* 메뉴경로 */
						, IFNULL(A.UPPER_MENU_CD , '0') AS UPPER_MENU_CD								/* 부모번호 */
 						, LTRIM (SYS_CONNECT_BY_PATH (A.MENU_NM, ' > '), ' > ') AS DEPTH_FULLNAME	/*전체 메뉴 경로*/ 
						, IFNULL(A.USE_YN, '') AS USE_YN  												/* 메뉴코드 사용여부 */
	                    , B.NEW_YN			AS NEW_YN												/* 등록권한여부 1 사용 0 미사용*/	  
	                    , B.READ_YN			AS READ_YN												/* 읽기권한여부 1 사용 0 미사용*/
	                    , B.DEL_YN 			AS DEL_YN												/* 삭제권한여부 1 사용 0 미사용*/
	                    , B.EXCELDOWN_YN	AS EXCELDOWN_YN											/* 엑셀다운권한여부 1 사용 0 미사용*/
	                    , A.MENU_ORDER		AS MENU_ORDER											/* ORDER BY 순서*/
	                    , A.MENU_DC			AS MENU_DC												/* 메뉴 설명*/
	                    , A.MENU_LEVEL  AS MENU_LEVEL												/* 메뉴 LEVEL*/
				  FROM CDT_MENU A
	         LEFT JOIN CDT_MENU_AUTH B
                    ON A.MENU_CD = B.MENU_CD   ]]>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
        	<![CDATA[   A.USE_YN='Y'             ]]>
        		
        	<if test="urIdx != null and urIdx != ''">
	        	<![CDATA[ AND  B.UR_IDX=#{urIdx}        ]]>
       		</if>
	        <![CDATA[ AND  B.READ_YN='Y'   ]]>       		
			<![CDATA[   
				START WITH A.MENU_LEVEL=1
				CONNECT BY PRIOR
 				A.MENU_CD = DECODE(B.MENU_CD, A.UPPER_MENU_CD, NULL, A.UPPER_MENU_CD)
 				
 				ORDER BY A.MENU_CD ASC
			]]>
			
		</trim>		 -->	
    </select>
   
   
    <select id="selectMenuTemplateList" parameterType="menuRequest"	resultType="menuResponse">
		<![CDATA[
				SELECT 
						  	   IFNULL(TEMPLATE_CD   , '') AS TEMPLATE_CD    /*템플릿코드*/
							,  IFNULL(TEMPLATE_NM   , '') AS TEMPLATE_NM    /*템플릿명*/
							,  IFNULL(TEMPLATE_MEMO , '') AS TEMPLATE_MEMO  /*템플릿설명*/
							,  IFNULL(REG_DT        , '') AS REG_DT         /*등록일*/
							,  IFNULL(REG_ID        , '') AS REG_ID         /*등록자*/
							,  IFNULL(MOD_DT        , '') AS MOD_DT         /*수정자*/
							,  IFNULL(MOD_ID        , '') AS MOD_ID         /*수정자*/
							,  IFNULL(ROLE          , '') AS ROLE           /**/
				  FROM CDT_MENU_TEMPLATE
                      ]]>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
        	<if test="templateCd != null and templateCd != ''">
	        	<![CDATA[ AND TEMPLATE_CD =#{templateCd}        ]]>
       		</if>
       		<if test="templateNm != null and templateNm != ''">
	        <![CDATA[ AND  TEMPLATE_NM= #{templateNm}   ]]>
	        </if>       		
		</trim>			
    </select>
    
     <select id="selectMenuInfoAll" parameterType="menuRequest"	resultType="menuResponse">
		<![CDATA[
				SELECT 
						  IFNULL(A.MENU_CD, '')  AS MENU_CD   											/* 메뉴코드 */
						, IFNULL(A.MENU_NM, '')  AS MENU_NM   											/* 메뉴명  */
						, IFNULL(A.MENU_URL, '') AS MENU_URL  											/* 메뉴경로 */
						, IFNULL(A.UPPER_MENU_CD , '0') AS UPPER_MENU_CD								/* 부모번호 */
 						, LTRIM (SYS_CONNECT_BY_PATH (A.MENU_NM, ' > '), ' > ') AS DEPTH_FULLNAME	/*전체 메뉴 경로*/ 
						, IFNULL(A.USE_YN, '') AS USE_YN  												/* 메뉴코드 사용여부 */
	                    , B.NEW_YN			AS NEW_YN												/* 등록권한여부 1 사용 0 미사용*/	  
	                    , B.READ_YN			AS READ_YN												/* 읽기권한여부 1 사용 0 미사용*/
	                    , B.DEL_YN 			AS DEL_YN												/* 삭제권한여부 1 사용 0 미사용*/
	                    , B.EXCELDOWN_YN	AS EXCELDOWN_YN											/* 엑셀다운권한여부 1 사용 0 미사용*/
	                    , A.MENU_ORDER		AS MENU_ORDER											/* ORDER BY 순서*/
	                    , A.MENU_DC			AS MENU_DC												/* 메뉴 설명*/
	                    , A.MENU_LEVEL  AS MENU_LEVEL												/* 메뉴 LEVEL*/
				  FROM CDT_MENU A
	         LEFT JOIN CDT_MENU_AUTH B
                    ON A.MENU_CD = B.MENU_CD   ]]>
        <trim prefix="WHERE" prefixOverrides="AND|OR">
        	<![CDATA[	 A.USE_YN='Y'             
					AND  B.READ_YN='Y' 
					START WITH A.MENU_LEVEL=1
					CONNECT BY PRIOR
 					A.MENU_CD = DECODE(B.MENU_CD, A.UPPER_MENU_CD, NULL, A.UPPER_MENU_CD)
 					ORDER BY A.MENU_CD ASC
			]]>
		</trim>			
    </select>
</mapper>

    
    